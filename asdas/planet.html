<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Escape the Circles â€” Bouncy</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<style>
html, body {
  margin: 0;
  padding: 0;
  overflow: hidden;
  background: #050510;
}
canvas {
  display: block;
}
</style>
</head>
<body>

<canvas id="c"></canvas>

<script>
/* ======================================================
   CANVAS SETUP
====================================================== */
const canvas = document.getElementById("c");
const ctx = canvas.getContext("2d");

let W, H, CX, CY;

function resize() {
  W = canvas.width = window.innerWidth;
  H = canvas.height = window.innerHeight;
  CX = W / 2;
  CY = H / 2;
}
window.addEventListener("resize", resize);
resize();

/* ======================================================
   BALL (MORE ENERGY)
====================================================== */
const ball = {
  x: CX,
  y: CY,
  r: 6,
  vx: 5.5,
  vy: 4.8,
  energy: 1.05
};

/* ======================================================
   CIRCLES
====================================================== */
const circles = [];
let baseRadius = 40;
const maxCircles = 1000;

function addCircle() {
  if (circles.length >= maxCircles) return;

  circles.push({
    radius: baseRadius + circles.length * 18,
    gapAngle: Math.random() * Math.PI * 2,
    gapSize: Math.PI / 9,
    rotation: Math.random() * Math.PI * 2,
    speed: (Math.random() * 0.004 + 0.001) * (Math.random() < 0.5 ? -1 : 1)
  });
}

setInterval(addCircle, 1000);
addCircle();

/* ======================================================
   PHYSICS HELPERS
====================================================== */
function reflect(nx, ny) {
  const dot = ball.vx * nx + ball.vy * ny;

  ball.vx -= 2 * dot * nx;
  ball.vy -= 2 * dot * ny;

  /* Add chaos */
  const angleJitter = (Math.random() - 0.5) * 0.6;
  const cos = Math.cos(angleJitter);
  const sin = Math.sin(angleJitter);

  const vx = ball.vx;
  const vy = ball.vy;

  ball.vx = vx * cos - vy * sin;
  ball.vy = vx * sin + vy * cos;

  /* Energy boost */
  ball.vx *= ball.energy;
  ball.vy *= ball.energy;
}

/* ======================================================
   ANIMATION LOOP
====================================================== */
function animate() {
  requestAnimationFrame(animate);

  ctx.fillStyle = "rgba(5,5,20,0.3)";
  ctx.fillRect(0, 0, W, H);

  /* Move ball */
  ball.x += ball.vx;
  ball.y += ball.vy;

  /* Screen bounds bounce */
  if (ball.x < ball.r || ball.x > W - ball.r) {
    ball.vx *= -1;
    ball.x = Math.max(ball.r, Math.min(W - ball.r, ball.x));
  }
  if (ball.y < ball.r || ball.y > H - ball.r) {
    ball.vy *= -1;
    ball.y = Math.max(ball.r, Math.min(H - ball.r, ball.y));
  }

  /* Draw & collide circles */
  for (let c of circles) {
    c.rotation += c.speed;

    const dx = ball.x - CX;
    const dy = ball.y - CY;
    const dist = Math.hypot(dx, dy);

    if (Math.abs(dist - c.radius) < ball.r + 2) {
      const angle = Math.atan2(dy, dx);
      let diff = Math.abs(
        ((angle - c.gapAngle - c.rotation + Math.PI * 3) % (Math.PI * 2)) - Math.PI
      );

      if (diff > c.gapSize / 2) {
        const nx = dx / dist;
        const ny = dy / dist;

        /* Push ball away slightly to avoid sticking */
        ball.x += nx * 3;
        ball.y += ny * 3;

        reflect(nx, ny);
      }
    }

    /* Draw circle */
    ctx.beginPath();
    ctx.strokeStyle = "rgba(255,255,255,0.18)";
    ctx.lineWidth = 1.4;
    ctx.arc(
      CX,
      CY,
      c.radius,
      c.gapAngle + c.gapSize / 2 + c.rotation,
      c.gapAngle - c.gapSize / 2 + c.rotation + Math.PI * 2
    );
    ctx.stroke();
  }

  /* Draw ball */
  ctx.beginPath();
  ctx.fillStyle = "#ffffff";
  ctx.shadowBlur = 25;
  ctx.shadowColor = "#ffffff";
  ctx.arc(ball.x, ball.y, ball.r, 0, Math.PI * 2);
  ctx.fill();
  ctx.shadowBlur = 0;
}

animate();
</script>

</body>
</html>
